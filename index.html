<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mi Juego 3D - Roblox Style</title>
    <style>
        body {
            margin: 0;
            padding: 0;
            overflow: hidden;
            font-family: Arial, sans-serif;
            background-color: #1a1a2e;
            color: white;
        }
        
        #gameContainer {
            position: relative;
            width: 100vw;
            height: 100vh;
        }
        
        #ui {
            position: absolute;
            top: 20px;
            left: 20px;
            z-index: 100;
            background-color: rgba(0, 0, 0, 0.7);
            padding: 15px;
            border-radius: 10px;
            max-width: 300px;
        }
        
        #ui h2 {
            margin-top: 0;
            color: #4db8ff;
        }
        
        #instructions {
            margin-top: 10px;
            font-size: 14px;
            line-height: 1.4;
        }
        
        #loading {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 24px;
            z-index: 200;
        }
        
        #crosshair {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 20px;
            height: 20px;
            z-index: 100;
        }
        
        #crosshair:before, #crosshair:after {
            content: '';
            position: absolute;
            background-color: white;
        }
        
        #crosshair:before {
            width: 2px;
            height: 20px;
            left: 50%;
            transform: translateX(-50%);
        }
        
        #crosshair:after {
            width: 20px;
            height: 2px;
            top: 50%;
            transform: translateY(-50%);
        }
        
        button {
            background-color: #4db8ff;
            color: white;
            border: none;
            padding: 10px 15px;
            border-radius: 5px;
            cursor: pointer;
            font-weight: bold;
            margin-top: 10px;
        }
        
        button:hover {
            background-color: #3399cc;
        }
    </style>
</head>
<body>
    <div id="gameContainer">
        <div id="ui">
            <h2>Mi Juego 3D</h2>
            <p>¡Bienvenido a mi juego estilo Roblox!</p>
            <div id="instructions">
                <p><strong>Controles:</strong></p>
                <p>W, A, S, D - Moverse</p>
                <p>Espacio - Saltar</p>
                <p>Shift - Correr</p>
                <p>Ratón - Mirar alrededor</p>
                <p>ESC - Mostrar/ocultar cursor</p>
            </div>
            <button id="fullscreenBtn">Pantalla Completa</button>
        </div>
        
        <div id="crosshair"></div>
        
        <div id="loading">Cargando juego...</div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/controls/PointerLockControls.min.js"></script>
    <script>
        // Variables globales
        let scene, camera, renderer, controls;
        let moveForward = false;
        let moveBackward = false;
        let moveLeft = false;
        let moveRight = false;
        let canJump = false;
        let prevTime = performance.now();
        let velocity = new THREE.Vector3();
        let direction = new THREE.Vector3();
        let isLocked = false;
        
        // Elementos del DOM
        const gameContainer = document.getElementById('gameContainer');
        const loadingElement = document.getElementById('loading');
        const crosshair = document.getElementById('crosshair');
        const fullscreenBtn = document.getElementById('fullscreenBtn');
        
        // Inicializar el juego
        function init() {
            // Crear escena
            scene = new THREE.Scene();
            scene.background = new THREE.Color(0x87CEEB); // Color de cielo azul
            scene.fog = new THREE.Fog(0x87CEEB, 10, 100);
            
            // Crear cámara
            camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
            camera.position.y = 10;
            
            // Crear renderizador
            renderer = new THREE.WebGLRenderer({ antialias: true });
            renderer.setSize(window.innerWidth, window.innerHeight);
            renderer.shadowMap.enabled = true;
            renderer.shadowMap.type = THREE.PCFSoftShadowMap;
            gameContainer.appendChild(renderer.domElement);
            
            // Configurar controles
            controls = new THREE.PointerLockControls(camera, document.body);
            
            // Eventos de bloqueo de puntero
            controls.addEventListener('lock', function() {
                isLocked = true;
                crosshair.style.display = 'block';
                document.getElementById('ui').style.display = 'none';
            });
            
            controls.addEventListener('unlock', function() {
                isLocked = false;
                crosshair.style.display = 'none';
                document.getElementById('ui').style.display = 'block';
            });
            
            // Evento de clic para activar controles
            gameContainer.addEventListener('click', function() {
                if (!isLocked) {
                    controls.lock();
                }
            });
            
            // Eventos de teclado
            document.addEventListener('keydown', onKeyDown, false);
            document.addEventListener('keyup', onKeyUp, false);
            
            // Evento de tecla ESC para mostrar/ocultar cursor
            document.addEventListener('keydown', function(event) {
                if (event.code === 'Escape') {
                    if (isLocked) {
                        controls.unlock();
                    }
                }
            });
            
            // Configurar iluminación
            const ambientLight = new THREE.AmbientLight(0x606060, 0.6);
            scene.add(ambientLight);
            
            const directionalLight = new THREE.DirectionalLight(0xffffff, 0.8);
            directionalLight.position.set(50, 100, 50);
            directionalLight.castShadow = true;
            directionalLight.shadow.mapSize.width = 2048;
            directionalLight.shadow.mapSize.height = 2048;
            directionalLight.shadow.camera.near = 0.5;
            directionalLight.shadow.camera.far = 500;
            directionalLight.shadow.camera.left = -100;
            directionalLight.shadow.camera.right = 100;
            directionalLight.shadow.camera.top = 100;
            directionalLight.shadow.camera.bottom = -100;
            scene.add(directionalLight);
            
            // Crear terreno
            createTerrain();
            
            // Crear objetos en el mundo
            createWorldObjects();
            
            // Ocultar pantalla de carga
            loadingElement.style.display = 'none';
            
            // Iniciar bucle de animación
            animate();
        }
        
        // Crear terreno
        function createTerrain() {
            // Suelo
            const groundGeometry = new THREE.PlaneGeometry(200, 200, 50, 50);
            const groundMaterial = new THREE.MeshLambertMaterial({ color: 0x3a9b3a });
            const ground = new THREE.Mesh(groundGeometry, groundMaterial);
            ground.rotation.x = -Math.PI / 2;
            ground.receiveShadow = true;
            scene.add(ground);
            
            // Agregar algunos obstáculos y elementos
            const cubeGeometry = new THREE.BoxGeometry(5, 10, 5);
            const cubeMaterial = new THREE.MeshLambertMaterial({ color: 0x8B4513 });
            
            for (let i = 0; i < 10; i++) {
                const cube = new THREE.Mesh(cubeGeometry, cubeMaterial);
                cube.position.x = Math.random() * 100 - 50;
                cube.position.z = Math.random() * 100 - 50;
                cube.position.y = 5;
                cube.castShadow = true;
                scene.add(cube);
            }
            
            // Agregar algunas plataformas
            const platformGeometry = new THREE.BoxGeometry(15, 1, 15);
            const platformMaterial = new THREE.MeshLambertMaterial({ color: 0x9932CC });
            
            for (let i = 0; i < 5; i++) {
                const platform = new THREE.Mesh(platformGeometry, platformMaterial);
                platform.position.x = Math.random() * 80 - 40;
                platform.position.z = Math.random() * 80 - 40;
                platform.position.y = 15 + i * 10;
                platform.castShadow = true;
                platform.receiveShadow = true;
                scene.add(platform);
            }
        }
        
        // Crear objetos en el mundo
        function createWorldObjects() {
            // Agregar algunos árboles
            const trunkGeometry = new THREE.CylinderGeometry(0.5, 0.7, 5, 8);
            const trunkMaterial = new THREE.MeshLambertMaterial({ color: 0x8B4513 });
            
            const leavesGeometry = new THREE.SphereGeometry(3, 8, 6);
            const leavesMaterial = new THREE.MeshLambertMaterial({ color: 0x228B22 });
            
            for (let i = 0; i < 20; i++) {
                const trunk = new THREE.Mesh(trunkGeometry, trunkMaterial);
                trunk.position.x = Math.random() * 150 - 75;
                trunk.position.z = Math.random() * 150 - 75;
                trunk.position.y = 2.5;
                trunk.castShadow = true;
                scene.add(trunk);
                
                const leaves = new THREE.Mesh(leavesGeometry, leavesMaterial);
                leaves.position.x = trunk.position.x;
                leaves.position.z = trunk.position.z;
                leaves.position.y = 7;
                leaves.castShadow = true;
                scene.add(leaves);
            }
            
            // Agregar una casa simple
            const houseGroup = new THREE.Group();
            
            // Base de la casa
            const houseGeometry = new THREE.BoxGeometry(10, 8, 10);
            const houseMaterial = new THREE.MeshLambertMaterial({ color: 0xFFD700 });
            const house = new THREE.Mesh(houseGeometry, houseMaterial);
            house.position.y = 4;
            house.castShadow = true;
            house.receiveShadow = true;
            houseGroup.add(house);
            
            // Techo
            const roofGeometry = new THREE.ConeGeometry(8, 5, 4);
            const roofMaterial = new THREE.MeshLambertMaterial({ color: 0x8B0000 });
            const roof = new THREE.Mesh(roofGeometry, roofMaterial);
            roof.position.y = 10.5;
            roof.rotation.y = Math.PI / 4;
            roof.castShadow = true;
            houseGroup.add(roof);
            
            // Posicionar la casa
            houseGroup.position.set(20, 0, 20);
            scene.add(houseGroup);
        }
        
        // Manejar eventos de teclado
        function onKeyDown(event) {
            switch (event.code) {
                case 'ArrowUp':
                case 'KeyW':
                    moveForward = true;
                    break;
                    
                case 'ArrowLeft':
                case 'KeyA':
                    moveLeft = true;
                    break;
                    
                case 'ArrowDown':
                case 'KeyS':
                    moveBackward = true;
                    break;
                    
                case 'ArrowRight':
                case 'KeyD':
                    moveRight = true;
                    break;
                    
                case 'Space':
                    if (canJump === true) {
                        velocity.y += 15;
                    }
                    canJump = false;
                    break;
            }
        }
        
        function onKeyUp(event) {
            switch (event.code) {
                case 'ArrowUp':
                case 'KeyW':
                    moveForward = false;
                    break;
                    
                case 'ArrowLeft':
                case 'KeyA':
                    moveLeft = false;
                    break;
                    
                case 'ArrowDown':
                case 'KeyS':
                    moveBackward = false;
                    break;
                    
                case 'ArrowRight':
                case 'KeyD':
                    moveRight = false;
                    break;
            }
        }
        
        // Bucle de animación
        function animate() {
            requestAnimationFrame(animate);
            
            if (controls.isLocked === true) {
                const time = performance.now();
                const delta = (time - prevTime) / 1000;
                
                // Calcular velocidad de movimiento
                velocity.x -= velocity.x * 10.0 * delta;
                velocity.z -= velocity.z * 10.0 * delta;
                velocity.y -= 9.8 * 25.0 * delta; // Gravedad
                
                direction.z = Number(moveForward) - Number(moveBackward);
                direction.x = Number(moveRight) - Number(moveLeft);
                direction.normalize();
                
                if (moveForward || moveBackward) velocity.z -= direction.z * 200.0 * delta;
                if (moveLeft || moveRight) velocity.x -= direction.x * 200.0 * delta;
                
                // Aplicar movimiento
                controls.moveRight(-velocity.x * delta);
                controls.moveForward(-velocity.z * delta);
                
                // Verificar si está en el suelo
                if (controls.getObject().position.y < 10) {
                    velocity.y = 0;
                    controls.getObject().position.y = 10;
                    canJump = true;
                }
                
                prevTime = time;
            }
            
            renderer.render(scene, camera);
        }
        
        // Manejar redimensionado de ventana
        window.addEventListener('resize', function() {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        });
        
        // Botón de pantalla completa
        fullscreenBtn.addEventListener('click', function() {
            if (!document.fullscreenElement) {
                gameContainer.requestFullscreen().catch(err => {
                    console.error(`Error al intentar activar pantalla completa: ${err.message}`);
                });
            } else {
                document.exitFullscreen();
            }
        });
        
        // Inicializar el juego cuando la página cargue
        window.onload = init;
    </script>
</body>
</html>
